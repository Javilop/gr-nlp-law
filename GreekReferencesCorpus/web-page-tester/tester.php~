<?php

define("DEBUG_SQL", 0);
error_reporting(E_ALL);

include("lib.database.php");

$DB = new db("references", "localhost", "root", "1997");
$DB->q('SET NAMES %s', 'UTF8');

Mb_Internal_Encoding ( 'UTF-8' );
$loc = "UTF-8";
putenv("LANG=$loc");
$loc = setlocale(LC_ALL, $loc);

if (isset($_GET['testing'])) {
  echo "Time: " . date("H:i:s");
  $_GET['testing'] = trim($_GET['testing']);
  
  $pattern = '/([Αα]ρθ-?[0-9]+)/i'; //$_GET['testing'];
    
  $replacement = '<i>$1</i>';

  $all_refs = $DB->q('KEYTABLE SELECT ref_id as ARRAYKEY, ref_text FROM all_ref ORDER BY ref_id');
  foreach($all_refs as $cid => $cref) {
    $value = $cref['ref_text'];
    
    $value = mb_strtolower($value);
    
    $result = preg_replace($pattern, $replacement, $value);
    if ($result == '')
      $result = $value;
    
    echo <<<EOD
<div title="{$value}">$cid: $result</div>\n
EOD;
  }
  exit;
}

?>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>References testing sciprt</title>
    <script src="jquery-1.8.1.min.js" type="text/javascript"></script>
    <script>
      $(document).ready(function(){
	$("#testing").keyup(function(){
	  var val = $(this).val();
	  $.get("tester.php", {testing: val}, function(data) {
	    $('#results').html(data);
	  });
	});
      });
    </script>
    <style>
      i {
	color: red;
      }
    </style>
  </head>
  <body>
  <div style="position:fixed; top:5px; right: 5px; bachground-color: white">
    Test regular expression: <input id="testing" style="width: 500px;">
    </div>
  <div id="results" style="padding:top: 40px;">
  </div>
  </body>
</html>
  
